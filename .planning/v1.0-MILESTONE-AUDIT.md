---
milestone: v1.0
audited: 2026-02-22T12:00:00Z
status: gaps_found
scores:
  requirements: 20/30
  phases: 2/5
  integration: 14/20
  flows: 1/4
gaps:
  requirements:
    - id: "CMD-05"
      status: "unsatisfied"
      phase: "Phase 2"
      claimed_by_plans: ["02-01-PLAN.md"]
      completed_by_plans: ["02-01-SUMMARY.md"]
      verification_status: "passed"
      evidence: "Integration checker confirms sdk_query TypeError at runtime — can_use_tool and hooks passed as top-level kwargs to sdk_query() instead of being set on ClaudeAgentOptions. All unit tests pass because mock accepts arbitrary kwargs."
    - id: "CMD-07"
      status: "partial"
      phase: "Phase 2"
      claimed_by_plans: ["02-01-PLAN.md", "02-04-PLAN.md"]
      completed_by_plans: ["02-01-SUMMARY.md", "02-04-SUMMARY.md"]
      verification_status: "passed"
      evidence: "--verbose/--quiet flags are accepted at CLI level and propagated to WorkflowEngine, but never forwarded to TransportConfig or ClaudeAgentOptions. Only status command quiet flag works via _output(). Command workflows silently ignore these flags."
    - id: "TRNS-05"
      status: "unsatisfied"
      phase: "Phase 3"
      claimed_by_plans: []
      completed_by_plans: []
      verification_status: "missing"
      evidence: "Phase 3 not yet planned or executed"
    - id: "TRNS-06"
      status: "unsatisfied"
      phase: "Phase 3"
      claimed_by_plans: []
      completed_by_plans: []
      verification_status: "missing"
      evidence: "Phase 3 not yet planned or executed"
    - id: "OUT-03"
      status: "unsatisfied"
      phase: "Phase 3"
      claimed_by_plans: []
      completed_by_plans: []
      verification_status: "missing"
      evidence: "Phase 3 not yet planned or executed"
    - id: "OUT-04"
      status: "unsatisfied"
      phase: "Phase 3"
      claimed_by_plans: []
      completed_by_plans: []
      verification_status: "missing"
      evidence: "Phase 3 not yet planned or executed"
    - id: "INT-01"
      status: "unsatisfied"
      phase: "Phase 4"
      claimed_by_plans: []
      completed_by_plans: []
      verification_status: "missing"
      evidence: "Phase 4 not yet planned or executed"
    - id: "INT-02"
      status: "unsatisfied"
      phase: "Phase 4"
      claimed_by_plans: []
      completed_by_plans: []
      verification_status: "missing"
      evidence: "Phase 4 not yet planned or executed"
    - id: "INT-03"
      status: "unsatisfied"
      phase: "Phase 4"
      claimed_by_plans: []
      completed_by_plans: []
      verification_status: "missing"
      evidence: "Phase 4 not yet planned or executed"
    - id: "INT-04"
      status: "unsatisfied"
      phase: "Phase 4"
      claimed_by_plans: []
      completed_by_plans: []
      verification_status: "missing"
      evidence: "Phase 4 not yet planned or executed"
    - id: "STATE-03"
      status: "unsatisfied"
      phase: "Phase 5"
      claimed_by_plans: []
      completed_by_plans: []
      verification_status: "missing"
      evidence: "Phase 5 not yet planned or executed"
    - id: "STATE-04"
      status: "unsatisfied"
      phase: "Phase 5"
      claimed_by_plans: []
      completed_by_plans: []
      verification_status: "missing"
      evidence: "Phase 5 not yet planned or executed"
  integration:
    - from: "commands/engine.py"
      to: "transport/client.py -> sdk_query"
      issue: "can_use_tool and hooks passed as top-level kwargs to sdk_query() instead of being set on ClaudeAgentOptions object. Runtime TypeError confirmed."
      affected_requirements: ["CMD-01", "CMD-02", "CMD-03", "CMD-05", "INT-05"]
    - from: "transport/client.py"
      to: "cli.py error output"
      issue: "Transport exceptions (CLINotFound, ProcessError, TransportTimeout) propagate uncaught to CLI for command workflows. Results in Python traceback instead of structured JSON error."
      affected_requirements: ["TRNS-04", "OUT-01", "CMD-01", "CMD-02", "CMD-03"]
    - from: "commands/engine.py"
      to: "transport/types.py"
      issue: "--verbose/--quiet stored in WorkflowEngine but never forwarded to TransportConfig or ClaudeAgentOptions. Flags are silently dropped for command workflows."
      affected_requirements: ["CMD-07"]
  flows:
    - name: "Full command E2E (new-project/plan-phase/execute-phase)"
      breaks_at: "ClaudeTransport.run() -> sdk_query() TypeError on can_use_tool kwarg"
    - name: "Answer injection pipeline"
      breaks_at: "Same sdk_query TypeError — callback is correctly built but never reaches SDK"
    - name: "Error-to-JSON on command workflows"
      breaks_at: "No try/except in workflow functions or CLI dispatchers — crashes to traceback"
tech_debt:
  - phase: 01-foundation
    items:
      - "run_sync() uses anyio.from_thread.run() — requires active anyio worker thread context (latent; not called from CLI)"
      - "ROADMAP.md Progress table shows 01-03 unchecked and 2/3 plans — stale documentation"
  - phase: 02-core-commands
    items:
      - "plan_phase_workflow and execute_phase_workflow return type annotated as Any instead of CommandResult"
      - "5 orphaned sync wrappers: run_sync(), run_gsd_command_sync(), new_project_workflow_sync(), plan_phase_workflow_sync(), execute_phase_workflow_sync() — defined but never called"
      - "Test mocks for sdk_query accept arbitrary kwargs — cannot detect real signature mismatches"
---

# Milestone v1.0 Audit Report

**Audited:** 2026-02-22
**Status:** GAPS FOUND

## Executive Summary

Phases 1 and 2 are structurally complete — all 7 plans executed, 210+ tests passing, all artifacts exist and are wired. However, the integration checker found a **critical runtime defect**: the `can_use_tool` callback (answer injection) is passed as a top-level keyword argument to `sdk_query()` instead of being set on `ClaudeAgentOptions`, causing a `TypeError` at runtime. This breaks non-interactive command execution — the core value proposition.

Phases 3-5 (Reliability, Library API, Multi-Project) are not yet planned or executed, leaving 10 requirements unsatisfied.

## Scores

| Dimension | Score | Details |
|-----------|-------|---------|
| Requirements | 20/30 | 20 complete (Phases 1-2), 10 pending (Phases 3-5) |
| Phases | 2/5 | Phases 1-2 complete, 3-5 not started |
| Integration | 14/20 | 6 cross-phase links have issues |
| E2E Flows | 1/4 | Only status E2E works; command workflows break at SDK call |

## Phase Status

| Phase | Status | Score | Verification |
|-------|--------|-------|-------------|
| 1. Foundation | ✓ Passed | 5/5 | All truths verified |
| 2. Core Commands | ⚠ Integration issues | 8/8 (unit) | Automated pass, but runtime SDK wiring broken |
| 3. Reliability | ○ Not started | 0/4 | No plans or directory |
| 4. Library API | ○ Not started | 0/4 | No plans or directory |
| 5. Multi-Project | ○ Not started | 0/2 | No plans or directory |

## Requirements 3-Source Cross-Reference

### Phase 1 Requirements (12/12 Satisfied)

| Requirement | VERIFICATION.md | SUMMARY Frontmatter | REQUIREMENTS.md | Final Status |
|-------------|----------------|---------------------|-----------------|-------------|
| TRNS-01 | passed | 01-03 | [x] Complete | **satisfied** |
| TRNS-02 | passed | 01-03 | [x] Complete | **satisfied** |
| TRNS-03 | passed | 01-03 | [x] Complete | **satisfied** |
| TRNS-04 | passed | 01-03 | [x] Complete | **satisfied** (partial at integration level — see below) |
| STATE-01 | passed | 01-02 | [x] Complete | **satisfied** |
| STATE-02 | passed | 01-02 | [x] Complete | **satisfied** |
| OUT-01 | passed | 01-01 | [x] Complete | **satisfied** (partial at integration level — see below) |
| OUT-02 | passed | 01-01 | [x] Complete | **satisfied** |
| PKG-01 | passed | 01-01 | [x] Complete | **satisfied** |
| PKG-02 | passed | 01-01 | [x] Complete | **satisfied** |
| PKG-03 | passed | 01-01 | [x] Complete | **satisfied** |
| PKG-04 | passed | 01-01 | [x] Complete | **satisfied** |

### Phase 2 Requirements (8/8 Unit-Verified, 2 Integration Issues)

| Requirement | VERIFICATION.md | SUMMARY Frontmatter | REQUIREMENTS.md | Final Status |
|-------------|----------------|---------------------|-----------------|-------------|
| CMD-01 | passed | 02-02, 02-04 | [x] Complete | **partial** (SDK wiring broken) |
| CMD-02 | passed | 02-03, 02-04 | [x] Complete | **partial** (SDK wiring broken) |
| CMD-03 | passed | 02-03, 02-04 | [x] Complete | **partial** (SDK wiring broken) |
| CMD-04 | passed | 02-02, 02-04 | [x] Complete | **satisfied** |
| CMD-05 | passed | 02-01, 02-04 | [x] Complete | **unsatisfied** (runtime TypeError) |
| CMD-06 | passed | 02-01, 02-04 | [x] Complete | **satisfied** |
| CMD-07 | passed | 02-01, 02-04 | [x] Complete | **partial** (flags silently dropped) |
| INT-05 | passed | 02-01, 02-04 | [x] Complete | **partial** (engine works, SDK delivery broken) |

### Phase 3-5 Requirements (0/10 — Not Started)

| Requirement | Phase | Final Status |
|-------------|-------|-------------|
| TRNS-05 | Phase 3 | **unsatisfied** |
| TRNS-06 | Phase 3 | **unsatisfied** |
| OUT-03 | Phase 3 | **unsatisfied** |
| OUT-04 | Phase 3 | **unsatisfied** |
| INT-01 | Phase 4 | **unsatisfied** |
| INT-02 | Phase 4 | **unsatisfied** |
| INT-03 | Phase 4 | **unsatisfied** |
| INT-04 | Phase 4 | **unsatisfied** |
| STATE-03 | Phase 5 | **unsatisfied** |
| STATE-04 | Phase 5 | **unsatisfied** |

## Critical Integration Issues

### Issue 1: sdk_query TypeError (CRITICAL)

**Location:** `src/openclawpack/transport/client.py` lines 103-115
**Impact:** All non-interactive commands (new-project, plan-phase, execute-phase) fail at runtime

`can_use_tool` and `hooks` are passed as top-level keyword arguments to `sdk_query()`, but the SDK function signature is `query(prompt, options, transport)`. These should be set on the `ClaudeAgentOptions` object instead:

```python
# Current (broken):
query_kwargs["can_use_tool"] = can_use_tool  # sdk_query doesn't accept this

# Required:
options.can_use_tool = can_use_tool  # Set on options object
```

**Why unit tests missed it:** Mock `fake_query(**kw)` accepts arbitrary kwargs.

**Affected:** CMD-01, CMD-02, CMD-03, CMD-05, INT-05

### Issue 2: Unstructured error output for command workflows

**Location:** No try/except in workflow functions or CLI dispatchers
**Impact:** Transport exceptions produce Python traceback instead of JSON

When `CLINotFound`, `ProcessError`, or `TransportTimeout` is raised during `new-project`, `plan-phase`, or `execute-phase`, the exception propagates uncaught through the workflow and CLI layers, resulting in a crash instead of `{"success": false, "errors": [...]}`.

**Affected:** TRNS-04, OUT-01, CMD-01, CMD-02, CMD-03

### Issue 3: --verbose/--quiet silently dropped

**Location:** `src/openclawpack/commands/engine.py` lines 47-48
**Impact:** Flags accepted but have no effect for command workflows

`WorkflowEngine` stores `verbose` and `quiet` but never forwards them to `TransportConfig` or `ClaudeAgentOptions`. Only the status command's `--quiet` works (via `_output()` in `cli.py`).

**Affected:** CMD-07

## Tech Debt

### Phase 1: Foundation
- `run_sync()` uses `anyio.from_thread.run()` — requires active anyio worker thread context (latent; not called from CLI)
- ROADMAP.md Progress table shows stale plan counts

### Phase 2: Core Commands
- `plan_phase_workflow` and `execute_phase_workflow` return type annotated as `Any` instead of `CommandResult`
- 5 orphaned sync wrappers defined but never called (dead code)
- Test mocks for `sdk_query` accept arbitrary kwargs — cannot detect real signature mismatches

## Orphaned Exports

| Export | File | Status |
|--------|------|--------|
| `ClaudeTransport.run_sync()` | transport/client.py | Dead code |
| `WorkflowEngine.run_gsd_command_sync()` | commands/engine.py | Dead code |
| `new_project_workflow_sync()` | commands/new_project.py | Dead code |
| `plan_phase_workflow_sync()` | commands/plan_phase.py | Dead code |
| `execute_phase_workflow_sync()` | commands/execute_phase.py | Dead code |

---

_Audited: 2026-02-22_
_Auditor: Claude (gsd-integration-checker + orchestrator)_
